---
- name: "ğŸ° CASINO SITES GENERATOR & DEPLOY - PRODUCTION"
  hosts: all
  become: true
  gather_facts: yes
  vars:
    generator_dir: "/var/www/casino_generator"

  tasks:
    - name: "ğŸ“¦ Install ImageMagick for favicon generation"
      apt:
        name: imagemagick-6.q16
        state: present
        update_cache: yes

    - name: "ğŸ“ Ensure generator dir exists"
      file:
        path: "{{ generator_dir }}"
        state: directory
        mode: '0755'

    - name: "ğŸ“¥ Clone/update git repository"
      git:
        repo: "https://github.com/kuleshovKV/semaphore-test.git"
        dest: "{{ generator_dir }}"
        version: master
        force: yes

    - name: "ğŸ”§ Ensure generate_sites.sh is executable"
      file:
        path: "{{ generator_dir }}/generate_sites.sh"
        mode: '0755'
        state: file

    - name: "ğŸš€ Run generation script"
      shell: "cd {{ generator_dir }} && ./generate_sites.sh"
      register: generation_output

    - name: "âœ… Show generation result"
      debug:
        msg: "{{ generation_output.stdout }}"
